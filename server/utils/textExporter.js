export const exportAsText = (data) => {
  const {
    score,
    skills = [],
    missingSkills = [],
    aiSuggestions = '',
    fileName = '',
    analysisDate = new Date().toISOString()
  } = data;

  const content = `
===========================================
      RESUME ANALYSIS REPORT
===========================================

ðŸ“… Generated: ${new Date(analysisDate).toLocaleString()}
ðŸ“„ Resume: ${fileName || 'Not specified'}

ðŸŽ¯ ATS COMPATIBILITY SCORE
${'='.repeat(30)}
Score: ${score}% ${getScoreStars(score)}
${getScoreInterpretationText(score)}

ðŸ“Š SKILLS ANALYSIS
${'='.repeat(30)}

âœ… SKILLS FOUND (${skills.length}):
${skills.length > 0 ? skills.map(skill => `  â€¢ ${skill}`).join('\n') : '  No skills extracted from resume'}

${missingSkills.length > 0 ? `
âŒ MISSING SKILLS (${missingSkills.length}):
${missingSkills.map(skill => `  â€¢ ${skill}`).join('\n')}
` : ''}

ðŸ’¡ AI RECOMMENDATIONS
${'='.repeat(30)}
${aiSuggestions}

ðŸ“‹ ACTION ITEMS
${'='.repeat(30)}
${getActionItems(score, missingSkills.length)}

âœ¨ QUICK IMPROVEMENT TIPS:
â€¢ Use relevant keywords from job description
â€¢ Quantify achievements with numbers (e.g., "Increased sales by 30%")
â€¢ Keep formatting simple and clean
â€¢ Include relevant certifications
â€¢ Customize resume for each job application
â€¢ Use standard section headers (Experience, Education, Skills)
â€¢ Avoid graphics and complex formatting
â€¢ Include contact information clearly

${'='.repeat(50)}
Report generated by AI Resume Analyzer
Powered by Groq LLM | MERN Stack Application
For more information, visit your application
${'='.repeat(50)}
  `.trim();

  // Create and download text file
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `resume-analysis-${Date.now()}.txt`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
};

const getScoreStars = (score) => {
  const filled = 'â˜…'.repeat(Math.floor(score / 20));
  const empty = 'â˜†'.repeat(5 - Math.floor(score / 20));
  return `[${filled}${empty}] ${score >= 80 ? 'Excellent' : score >= 60 ? 'Good' : 'Needs Improvement'}`;
};

const getScoreInterpretationText = (score) => {
  if (score >= 80) return 'Your resume is highly compatible with ATS systems!';
  if (score >= 60) return 'Your resume has potential but needs optimization.';
  return 'Your resume needs significant improvements for ATS compatibility.';
};

const getActionItems = (score, missingSkillsCount) => {
  if (score >= 80) {
    return `â€¢ Maintain current resume quality
â€¢ Continue updating with new skills and experiences
â€¢ Keep tailoring resume for specific job applications
â€¢ Update regularly with new achievements`;
  } else if (score >= 60) {
    return `â€¢ Add ${missingSkillsCount} missing skills to your resume
â€¢ Improve formatting and structure
â€¢ Quantify achievements with specific numbers
â€¢ Match keywords from job description
â€¢ Consider adding a professional summary`;
  } else {
    return `â€¢ Major revamp needed for ATS compatibility
â€¢ Add all ${missingSkillsCount} missing skills
â€¢ Match 80%+ keywords from job description
â€¢ Improve skill section organization
â€¢ Consider professional resume writing services
â€¢ Simplify formatting and remove graphics`;
  }
};